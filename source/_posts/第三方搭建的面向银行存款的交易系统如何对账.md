---
title: 第三方搭建的面向银行存款的交易系统如何对账
date: 2022-09-14 21:26:01
tags: 交易系统, 对账, 系统架构
---

# 第三方搭建的面向银行存款的交易系统如何对账
## 背景
前段时间沸沸扬扬的河南村镇银行的事件已经接近尾声，
这是一个面向银行存款的交易系统。一个完整的交易过程是这样：用户首先通过我们的系统开户，开户后银行会给用户分配一个电子账户。之后用户往该电子账户上充值。然后选择存款产品，完成购买。银行周期性的给这些存款订单派发收益。用户也可以随时主动发起存款订单的支取，或者等到存款到期，银行把钱打到用户的电子账户上。用户电子账户上的钱可以随时提现。以上就是一个完整的交易过程。因为我们的信息系统和银行的信息系统可能会因为系统缺陷、网络异常等原因造成两边数据不一致，从而影响到用户体验和导流分润等，所以通过对账来检查数据一致性就显得很有必要。

## 对账的目标
因为系统难免会存在缺陷、网络总是不稳定的。如果说补偿是保证数据最终一致性的关键机制，那对账是保证数据一致性的最后一道防线。对于这样一个交易系统，对账的一个基本目标就是完成两个信息系统间交易订单的核对。在对账之前，我们对自己的系统是有一个预期的：我们的系统数据和银行的系统数据大体一致。为什么说“大体”一致呢。因为有些东西天然就是不一致的，比如时间。信息流总是先经过我们，再经过银行，所以如果我们的时间总会比银行的时间早。但是订单状态、金额、产品信息等一定是一致的。
除此之外，还有一个目标就是同步订单收益，更新资产账户（累计收益账户、持有收益账户）。你可能会问：银行已经有账户了，我们为什么不直接查银行的？为什么要做账户？因为我们不止接一家银行，会有 N 家银行，在加上 M 家流量方，我们针对用户资产的统计需求是多维度的。如果要统计一个用户在我们系统的总收益，那么我们需要同时查询多家银行。再者就是银行也不是靠谱的，之前出现过有家银行可以无限提现，始终不扣减电子账户余额。话说回来，数据这个东西是业务的核心资产。有数据才能产生更多价值。

## 对账的流程